
# RFM-анализ клиентской базы аптечной сети

## Цель анализа

Перед нами стоит цель – провести SMS-рассылку для клиентов нашей сети, и сделать это максимально эффективно. Эффективность в данном случае выражается отношением:

![formula](rfm_pharmacy/assets/formula.png)

Расходы на привлечение разных категорий клиентов, отличаются незначительно (стоимость одного SMS), но значительную часть расходов можно сократить, если убрать из рассылки категорию клиентов, которая нам не интересна. 

Прибыль, полученную от привлечения клиента, мы можем увеличить за счет рассылки SMS с разным содержанием для разных категорий клиентов, тем самым повышая конверсию продаж.  

Было принято решение провести RFM-сегментацию всех клиентов, имеющих бонусную карту, на основании давности последней покупки, частоты покупок и суммы трат за все время.

## Задачи
### 1. Сегментировать клиентов:
 a) По дате последней покупки (Recency);

 b) По частоте покупок (Frequency);
 
 c) По сумме трат (Monetary).
### 2. Проанализировать сформированные RFM-группы и дать рекомендации для каждой из них.
### 3. Сделать выводы об успешности программы лояльности.

## Инструменты

- PostgreSQL

> Формирование SQL-запросов

- Metabase

> Визуализация результатов SQL-запросов

## Исходные данные

Таблица sales из базы данных аптечной сети со столбцами:

- DR_Dat - дата покупки
- DR_Tim - время покупки
- DR_NChk - номер чека
- DR_NDoc - номер кассового документа
- DR_Shop - номер магазина (FK - shops)
- DR_Kkm - номер кассового аппарата
- DR_TDoc - вид документа
- DR_TPay - форма платежа (18 - безнал, 15 - нал)
- DR_CGoods - артикул товара
- DR_NGoods - название товара
- DR_Kol - кол-во проданного товара
- DR_CZak - закупочная цена
- DR_CRoz - розничная цена
- DR_SDisc - сумма скидки
- DR_CDisc - код скидки
- DR_BCDisc - штрихкод скидки
- DR_TabEmpl - табельный номер сотрудника (FK - employee)
- DR_Pos - номер позиции в чеке
- DR_VZak - вид закупки (1 - обычный, 2 - интернет-заказ)


# Решение 
## 1. Сегментация клиентов
### a) Анализ Recency

Изобразим на диаграмме распределение клиентов по давности последней покупки:

![recency_dist](rfm_pharmacy/assets/recency_dist.png)

Распределение скошено влево, что говорит нам о преобладании “недавней” группы клиентов.

Проведем сегментацию, визуально определив границы групп:

1. Недавние - клиенты, совершившие покупку в последние 10 дней;
2. Спящие - совершившие покупку от 10 до 25 дней назад;
3. Давние - не совершавшие покупки более 25 дней.

![recency_groups](rfm_pharmacy/assets/recency_groups.png)

### b) Анализ Frequency

Изобразим на диаграмме распределение клиентов по количеству покупок за 7 дней , ограничившись 90-% перцентилем :

![frequency_dist](rfm_pharmacy/assets/frequency_dist.png)

После фильтрации выбросов мы получили распределение, напоминающее нормальное. Сегментируем клиентов на три группы, основываясь на медианном значении (1 покупка):

![frequency_groups](rfm_pharmacy/assets/frequency_groups.png)

Такое распределение вполне типично для розничной торговли - присутствует как костяк лояльных клиентов, так и небольшое количество разовых посетителей. “Частая” и “редкая” категории примерно равны по количеству клиентов, что соответствует нормальному распределению значений, а значит срок оценки в 7 дней был выбран верно.

### c) Анализ Monetary

Изобразим на гистограмме распределение клиентов по сумме потраченных средств, ограничившись 90-% перцентилем:

![monetary_dist](rfm_pharmacy/assets/monetary_dist.png)

На диаграмме мы видим сильный перекос в сторону низкого monetary. Большинство клиентов совершают покупки на небольшие суммы, что вполне согласуется с принципом Парето - 20% клиентов приносят 80% прибыли.

Для сегментации клиентов, визуально выделим границы групп:

1. “Экономные ” - с суммой затрат от 0 до 800 рублей;
2. Со средним чеком - от 800 до 1800 рублей;
3. C большим чеком - от 1800 рублей и выше. 

![monetary_groups](rfm_pharmacy/assets/monetary_groups.png)

## 2. Формирование RFM-групп и рекомендации по каждой из них

Сформируем RFM группы:

![rfm_groups](rfm_pharmacy/assets/rfm_groups.png)

Теперь, выделим среди 24 групп самые интересные для нас с точки зрения удержания:	

![sms_groups](rfm_pharmacy/assets/sms_groups.png)

1. VIP-клиенты

К ним относятся клиенты из категории 111 - недавние частые с большим чеком. Они уже хорошо покупают, и поэтому в SMS могут содержаться персональные предложения для поддержания лояльности.

2. Перспективные клиенты

Клиенты из категорий 112, 121, 122, 131, 211 и  212. Им подойдет рассылка с сопутствующими товарами и акциями для поддержания интереса. 

3. Лояльные экономные

Категории 113  и 123. Доля этих клиентов незначительна, но у них есть потенциал совершать более дорогие покупки. В рассылке делаем упор на скидочные программы и акции.

4. Новички

Клиенты, недавно совершившие первую покупку - 131-133 категории. Им необходимо разослать приветственные сообщения, чтобы напомнить об участии в программе лояльности.

5. Середнячки

Наша самая большая группа клиентов, совершающих покупки со средней периодичностью - 221-223 категории. SMS-рассылка для этой группы дорого нам обойдется, но вряд ли повлияет на их поведение. 

6. Под угрозой оттока

321-323 категории. Более-менее частые клиенты, не совершавшие покупки в последнее время. Они составляют немалую часть от общего числа, поэтому будет целесообразно отправить им сообщения, побуждающие вернуться к нам. Это могут быть персональные скидки на сезонные лекарства или зачисление небольшой суммы бонусных баллов на карту.

7. Бывшие лояльные

 Клиенты из категорий 311-313. Клиенты, которые ранее регулярно заходили к нам, но перестали по какой-либо причине. Радует, что эта группа совсем небольшая, и мы можем позволить себе включить эту группу в ту же рассылку, как и для клиентов “под угрозой оттока”. 

## 3. Общие выводы об успешности программы лояльности

RFM-анализ – лишь инструмент для сегментации пользователей. Трудно сказать что-то об успехах бизнеса, основываясь исключительно на его результатах. Тем не менее, с его помощью мы можем не только эффективнее провести SMS-рассылку, но и сделать несколько других полезных выводов:

### 1. Регистрации бонусных карт

Построим диаграмму, отображающую количество новых регистраций за каждую неделю в сравнении с общим количеством продаж:

![purchases_and_regs)](rfm_pharmacy/assets/purchases_and_regs.png)

Как видно на графике, мы имеем стабильный приток клиентов в нашу программу лояльности, коррелирующий с общим количеством продаж за неделю.

### 2. Проблемы с удержанием клиентов

 Однако, нас интересует не только количество выданных карт, а также sticking coefficient - сколько людей действительно заинтересованы в программе лояльности.

![sticking](rfm_pharmacy/assets/sticking.png)

Из результатов дополнительного анализа следует, что две трети (62%) наших клиентов, имеющих бонусную карту, совершили лишь одну покупку, из которых половина - больше трех недель назад. Это говорит нам о том, что наша программа лояльности слабо заинтересовывает клиентов. 
